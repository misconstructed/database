#### 6장

## 정규 관계형 질의 언어

### 관계 대수 연산

- 관계 대수 연산은 절차적 질의 언어
  - 한 개 혹은 두 개의 릴레이션들을 입력으로 받아 그 결과로 새로운 릴레이션을 생성하는 연산들의 집합으로 구성
  - 기본적인 연산으로는 선택, 추출, 합, 차, 카티션 곱, 재명명 연산
  - 추가적인 연산으로는 교집합, 자연조인, 배정 연산

#### 기본 연산

- 단한 연산(unary operation) : 한 릴레이션에 대해서 수행 (선택, 추출, 재명명)
- 이항 연산(binary operation) : 한 쌍의 릴레이션에 대하여 연산을 수행

1. 선택 연산(selection) : 주어진 술어를 만족하는 튜플들을 선택
   - 그리스 문자의 소문자 시그마를 사용
   - 일반적으로 비교 연산을 사용하고, and, or, not 등의 연결 기호를 사용하면 여러 개의 술어들을 하나의 큰 술어로 결합시킬 수 있음
   - 관계대수 연산에서는 select가 SQL의 where에 해당함
2. 추출 연산(project)
   - 입력 릴레이션의 어떤 속성들을 삭제한 후 나머지 모두를 결과 릴레이션으로 추출
   - 릴레이션을 집합이므로 어떠한 중복도 제거됨
   - 대문자 파이를 기호로 사용
     - 얻고자 하는 속성들을 파이의 아래첨자로 표시
3. 혼합 관계 연산
   - 관계 연산의 결과는 릴레이션 자체
   - 합집합(union) : 서로 양립할 수 있는 릴레이션(compatible relation)끼리 행해져야 함
     - 릴레이션 r과 s는 같은 수의 속성을 가져야 함
       - 릴레이션 r의 i번째 속성의 도메인과 릴레이션 s의 i번째 속성의 도메인을 서로 같아야 함
   - 차집합 : 기호 '-' 로 나타나는 차집합 연산은 한 릴레이션에는 속하고 다른 릴레이션에는 속하지 않은 튜플을 찾는다.

4. 카타션 곱(Cartesian product)
   - 곱하기 기호(x)로 나타남
   - 어떤 릴레이션의 결합된 정보를 얻는데 사용됨
   - 속성들을 구별하기 위해 스키마 이름을 줌
   - A릴레이션에 n1개, B릴레이션에 n2개의 튜플이 존재한다면, 카타션 곱의 결과로는 n1 * n2 개의 튜플이 존재함
5. 재명명 연산(rename) : 관계 대수식의 결과에 이름을 주는데 사용
   - 그리스 문자 소문자 로우
   - <code>px(E)</code> : 식E의 결과를 이름 x로 돌려줌
     - 릴레이션 자체도 관계 대수식으로 고려될 수 있으므로 어떠한 릴레이션을 새로운 이름으로 참조할 수 있도록 릴레이션에도 재명명 연산을 적용할 수 있음

#### 관계 대수의 형식적 정의

- 관계형 대수의 기본 표현식
  1. 데이터베이스 내의 하나의 릴레이션
  2. 하나의 상수 릴레이션
     - 상수 릴레이션은 [] 안에 튜플들을 나열하는 식으로 사용

#### 추가 관계 대수 연산

- 관계 대수의 표현력을 증가시키지는 못하지만 흔히 사용되는 질의를 간단하게 표현할 수는 있음

1. 교집합(intersection) : r - (r - s)

2. 자연 조인(natural join) : 선택과 카티션 곱을 하나로 결합한 이항 연산

   - 두 입력 릴레이션의 카티션 곱을 구한 뒤, 공통으로 나타나는 속성들에서 같은 값을 가진 튜플들만 선택 후, 중복 속성 하나를 제거
   - r과 s의 교집합이 없으면 자연조인은 r x s 와 동일하다
   - 자연 조인은 결합 법칙(associative rule) 을 만족함
   - 세타 조인(theta join) 연산은 선택과 카티션 곱을 하나의 연산으로 결합할 수 있도록 해주는 자연 조인의 변형

3. 배정 연산(assignment)

   - 배정은 항상 일시적 릴레이션 변수로 되어 있어야 함
     - 영구 릴레이션에 대한 배정은 데이터베이스 수정을 수행

   - 복잡한 질의를 표현하는데 편리한 방법

4. 외부 조인 연산(outer-join) 

   - 누락된 정보를 다룰 수 있도록 조인 연산을 확장
     - 널 값을 결과에 포함시킴으로써 읽어버릴 수 있는 튜플들을 보존
   - 좌측 외부 조인(left outer join) : 어떤 튜플과도 부한되지 않은 왼쪽 릴레이션의 모든 튜플들을 취함
   - 우측 외부 조인(right outer join) : 어떤 튜플과도 부함되지 않는 오른쪽 릴레이션 내의 모든 튜플들을 취함
   - 완전 외부 조인(full outer join) : 좌측 외부 조인과 우측 외부 조인을 모두 수행
   - 수행의 결과가 널 값을 발생시키기 때문에, 널 값을 어떻게 처리할 것인가를 확실하게 규정해야 함

#### 확장 관계 대수 연산

- 기본 관계 대수 연산으로 표현할 수 없는 질의를 기술

1. 일반화 추출(generalized projection) : 추출 리스트에 산술 및 문자열 함수 사용을 허용
   - +, -, *, % 와 같은 산술 연산을 사용할 수 있음
2. 집합체 함수(aggregation function) : 최소값이나 평균값과 같은 집합체 함수를 사용할 수 있음
   - sum(합), avg(평균), count(개수), min, max
   - 중복 집합(multi-set) : 하나의 값을 여러개 가질 수 있음, 순서는 중요하지 않음
     - 집합(set)은 각 요소의 하나의 사본만 존재하는 중복 집합의 특수한 경우
   - 칼리크래픽 G를 사용
     - 아래첨자로 된 부분은 적용될 연산의 종류를 나타냄
   - 중복을 제거하기 위해서는 함수명 뒤에 distinct를 하이픈으로 연결
     - ex) count-distinct

#### 튜플 관계 해석(relational calculus)

- 관계 대수식을 작성할 때에는 질의에 대한 해를 생성하기 위해 수행해야 할 연산의 순서를 명시

- 반면에 튜플 관계 해석은 비절차식 질의어

  - 사용자가 정보를 얻는 방법은 명시하지 않고, 원하는 정보의 내용만 기술

  - <code>{t | P(t)}</code> : 술어 P가 참인 모든 튜플 t의 집합

- 존재한다, and, or, not, 모든 것에 대해(for all)

- 형식적 정의
  - <code>{t|P(t)}</code> 
    - P는 하나의 식(formula)
      - 하나의 식에 여러 개의 튜플 변수들이 나타날 수 있음
      - 어떤 변수가 "존재한다." 또는 "모든 것에 대해"로 한정되지 않았을 때 그 번수를 자유 변수(free variable)라 함
        - 그 외에는 한정 변수(bound variable)라 함
    - 식은 원자(atom)로부터 만들어짐
- 표현식의 안정성
  - 튜플 관계 해석의 제한을 정의하기 위해, 튜플 관계 식 P의 도메인이라는 개념을 도입
  - P의 도메인 : 기호 dom(P)로 표현
    - P에 의해 참조되는 모든 값들의 집합
    - P에 명시적으로 나타나는 값들 또는 그 이름이 P에 나타난 하나 이상의 릴레이션에 나타난 값들의 집합
  - 안전한 표현식을 유한한 수의 결과를 보장함

