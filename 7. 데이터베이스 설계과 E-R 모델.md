7장

## 데이터베이스 설계와 E-R 모델

- 개체-관계 모델(E-R모델) 
  - 표현할 개체를 구분하고, 이 개체들의 연관성을 표현하는 방법 제공
  - E-R 설계가 릴레이션 스키마 집합으로 변경되는 방법, 제약조건들을 찾을 수 있는 방법

### 설계  과정의 개요

#### 설계 단계

1. 응용 프로그램의 요구조건을 알기 위해 응용 프로그램의 사용자들과 상호 작용
2. 사용자가 이해할 수 있도록 고급 표현 방식으로 나타냄
3. 요구조건을 설계의 하위 단계에 알맞게 변형

- 데이터베이스 설계 초기 단계는 장래의 데이터베이스 이용자들이 필요로 하는 데이터를 충분히 규정

  - 결과물 : 사용자의 요구 명세서

- 데이터 모델을 선택하고, 데이터베이스의 개념적인 스키마로 바꿈

  - 개념적 설계(conceptual design) 단계에서 개발된 스키마는 기업의 상세한 overview를 제공

  - 개체-관계 모델을 일반적으로 개념적 설계를 나타내는데 사용함
  - 스키마를 재검토
    - 중복되는 사항들이 있는지
    - 데이터와 그들의 관계를 기술

- 기능적 요구사항 명세서에 사용자들을 데이터에 적용될 연산들의 종류를 기술

- 추상 데이터 모델로부터 데이터베이스 수현으로 이동하는 과정

  1. 논리 설계 단계(logical-design phase) : 상위의 개념적 스키마를 사용할 데이터베이스의 구현 데이터 모델에 대응
  2. 데이터베이스 스키마를 데이터베이스의 물리적 속성들이 구체화하는 다음 단계인 물리 설계 단계(physical desigan phase)에 이용

#### 설계 대안

- 개체(entity) : 식별할 수 있는 물품을 지칭하는데 사용
- 중요한 위험성
  1. 중복성(redundancy) : 좋지 않은 설계는 정보를 여러 번 반복해서 저장함
     - 한 정보가 수정될 때, 중복되어 저장된 모든 복사본들을 수정할 수 있는 예방책들을 세우지 않을으로 인해 일관되지 않은 정보를 지니고 있을 수 있음
     - 정보는 정확히 안 장소에만 위치해야 함
  2. 불완정성(Incompleteness) : 어떤 조직의 특정을 모델화하기 어렵거나 불가능하게 함
     - 정보가 없는 속성을 null로 처리해버림

#### 개체 관계 모델(entity-relationship, E-R)

- 데이터베이스의 정체 논리 구조를 나타내는 조직의 스키마를 명시함으로써 데이터베이스 설계를 쉽게 하도록 개발

- 3가지 기본 개념

  1. 개체 집합(entity set)

     - 개체(entity) : 다른 모든 객체와 구별되는 유,무형의 사물
       - 개체는 속성들의 집합에 의해 표현됨
       - 각 개체는 그 속성들 각각에 대하셔 값(value)를 가진다.
     - 개체 집합은 같은 속성을 공유하는 같은 유형의 개체들의 집합
       - 개체 집합의 확장(extension) : 개체 집합에 포함되어 있는 개체들의 실제 모음을 지칭하기 위해 사용함
     - 개체 집합은 서로 중첩될 수 있음

     - 데이터베이스는 개체 집합들의 모임을 포함 : 같은 유형의 개체를 임의의 수만큼 포함

  2. 관계 집합(relationship set)

     - 관계(relationship) : 여러 개체들 사이의 연관성
       - 관계 인스턴스는 모델링하는 실세계의 조직 내의 명명된 개체들 사이에 연관성이 존재한다는 뜻
       - 역할(role) : 관계에서 개체가 행하는 기능을 개체의 역할이라고 함
         - 역할은 묵시적이고 보통 따로 명시되지 않음
       - 설명 속성(descriptive attribute) 이라는 속성을 가질 수 있음
         - 특정한 관계 집합에서 관계 인스턴스는 설명 속성들을 사용하지 않고 참가하는 개체들로부터 유일하게 구분될 수 있어야 함
     - 관계 집합 : 같은 유형의 관계들의 집합
       - 개체 집합 사이의 연관성을 참가(participation) 이라 함
       - 이진관계집합(binary relationship set) : 두 개체 집합이 관련된 관계 집합
         - 대부분의 관계 집합은 이진 관계 집합
         - 차수(degree) : 관계 집합에 참가하는 개체 집합의 수
           - 이진관계집합의 차수는 2

  3. 속성(attribute)

     - 도메인(domain) : 각 속성에 대해서 허용되는 값의 집합
       - 값 집합(value set) 
     - 각 개체는 개체 집합의 각 속성마다 (속성, 데이터값)의 쌍으로 기술될 수 있음
     - 송성을 값을 가지지 않을 때 null 값을 가짐
       - 해당 사항이 없음
       - 그 개체에 대한 값이 존재하지 않음

     1. 단순 속성(simple attribute) / 복합 속성(composite attribute) 
        - 단순 속성을 더 이상 작은 단위로 나누어지지 않는 속성
        - 복합 속성은 더 작은 단위로 나누어질 수 없음
          - 복합 속성을 사용하면 모델링을 더 명확하게 하고, 연관된 속성들을 한 그룹으로 묶을 수 있음
          - 복합 속성은 계층으로 나타낼 수 있음
     2. 단일값 속성(single-valued attribute) / 다중값 속성(multivalued attribute)
        - 단일값 속성 : 특정 개체에 대하여 하나의 값만을 가짐
        - 다중값 송성 : 특정 개체에 대하여 속성이 값들의 집합을 가질 수 있는 경우
          - <code>{ ... }</code> 와 같이 괄호로 묶어서 표현
          - 다중값 송성의 값의 개수에 상한과 하한이 주어질 수 있음
     3. 유도된 속성(derived attribute)
        - 다른 관련된 속성들이나 객체들의 값들로부터 유도되는 값
        - ex) date_of_birth 에서 age 를 계산할 수 있음
          - Date_of_birth 는 기본 속성(base attribute) 또는 저장된 속성(stored attribute)
        - 유도된 속성의 값을 저장되지 않고 필요할 때마다 계산될 수 있음

###제약 조건

- 제약조건을 데이터베이스가 어느 정도까지 준해야 할지를 정의

#### 대응수(mapping cardinality)

- 관계 집합을 통하여 다른 개체와 관련될 수 있는 개체의 수
- 이진 관계 집합을 나타내는데 가장 유용함

1. 일대일
2. 일대다
3. 다대일
4. 다대다

#### 참가 제약조건

- 전체적(total) : 모든 E의 개체가 적어도 R안의 한 관계에 참가해야 한다
- 부분적(partial) : E 내의 일부 개체들만 R의 관계에 참가하는 경우

#### 키

- 한 개체의 속성값들의 값들은 그 개체를 유일하게 구별할 수 있어야 함
  - 모든 속성들의 값이 정확하게 같은 개체들이 존재하면 안됨
- 키의 개념은 개체 집합들에 직접적으로 적용된
  - 개체 집합의 주 키는 집합의 여러 개체들을 구분할 수 있음
  - 개체 집합의 이름을 속성의 이름과 합하여 유일한 이름을 형성할 수 있어야 함
- 관계 집합을 위한 주 키의 구조는 관계 집합의 대응수에 종속적임
  - 다대다 : 두 관계의 주 키의 합집합
  - 다대일 : 다 관계의 주 키를 사용
  - 일대일 : 어떤 후보키가 주 키로 사용 하는

### 개체-관계 다이어그램

- 데이터베이스의 전방적 논리구조를 가시적으로 보여줌

#### 기본 구조

- 개체 집합을 나타내는 사각형
  - 개체 집합의 이름 표시
  - 개체 집합의 모든 속성들의 이름을 표시
  - 주 키의 일부분인 속성들을 밑줄
- 관계 집합을 표현하는 다이아몬드
  - 역할 : 다이아몬드를 사각형에 연결하는 선에 이름을 붙여 역할을 표시
- 개체 집합을 관계 집합에 연결하는 선
- 어떤 관계 집합의 속성들을 그 관계 집합에 연결하는 점선
- 전체적 참가를 나타내는 이중선
- 약성 개체 집합으로 연결된 식별관계 집합을 나타내는 이중 다이아몬드

#### 대응수

- 일대일, 일대다, 다대일, 다애다
  - 일 : 화살표
  - 다 : 직전
- 제약조건
  - l 이 최소이고 h가 최대 대응수 : <code>l..h</code>
  - <code>1..1</code> : 정확하게 1대1로 대응되어야 함
  - <code>0..*</code> : 0개 또는 여러개가 대응될 수 있음

#### 약성 개체 집합(weak entity set)

- 약성 개체 집합 : 주 키를 형성하기 위한 충분한 속성들을 지니고 있지 않은 개체 집합
- 강성 개체 집합 : 주 키를 가지고 있는 개체 집합
- 약성 개체 집합이 의미가 있기 위해서는 식별(identifying) 개체 집합이라 불리는 다른 개체 집합과 관련되어야 함
  - 모든 약성 개체는 식별 개체와 연관되어 있음
  - 약성 개체 집합은 식별 개체 집합에 존재 종속 관계(existence dependent)
    - 식별 개체는 실별하는 약성 개체 집합을 갖는다(own)고 함
  - 실별 관계는 약성 관계 집합으로부터 식별 관계 집으로의 다대일
    - 약성 관계 집합의 참가는 전체적
- 약성 개체 집합의 구별자(discriminator) 가 약성 개체 집합을 구분할 수 있도록함
  - 약성 개체의 구별자는 실선이 아닌 점선으로 및줄 그어져 있음
  - 약성 개체 집합을 식별 상성 집합과 연결하는 관계 집합은 이중 다이아몬드로 표시
  - 전체적인 참가를 가리키기 위해 이중선을 사용

### 릴레이션 스키마로의 축소

#### 단순 속성들을 지닌 강성 개체 집합의 표현

- 개체를 n개의 가른 속성들을 가진 스키마로 표현
- 릴레이션의 각각의 튜플들은 개체 집합의 한 개의 개체와 대응된
- 개체 집합의 주 키가 결과로 나온 주스키마의 주 키로 제공됨

#### 복합 속성들을 지난 강성 개체 집합의 표현

- 강성 개체 집합이 단순하지 않은 속성들
  - 별도의 송성을 생성함으로써 복합 속성을 다룸
  - 복합 속성 그 자체에 대해 별도의 속성을 생성하지는 않음
- 다중값 송성들은 다른 속성들과는 다르게 취급된
  - 속성들을 위해서 새로운 릴레이션 스키마를 만든다
- 유도된 속성들은 관계형 데이터 모델에서 명시적으로 표현하지 않음
  - 메소드로서 표현될 수 있음

#### 약성 개체 집합의 표현

- A가 약성 개체 집합, B는 A가 의족하는 강성 개체 집합인 경우
  - B의 주키와 A의 식별자의 합성이 스키마의 주 키로서의 역할을 수행
  - B의 주키를 참조하는 속성을 명시함으로서 외래 키 제약조건을 생성할 수 있음
    - 대응 튜플이 반드시 존재하도록 강제

#### 관계 집합의 표현

- 이진 다대다 : 주 키의 합집합이 주 키로 지정
- 이진 일대일 : 한 쪽의 개체 집합의 주 키가 주키로 지정

- 이진 다대일, 일대다 : 다 인 부분의 개체 집합의 주키를 주키로 지정
- 간선에 어떤 화살표도 업는 n항 관계 집합 : 참여하는 모든 개체 집합들의 주 키 속설들의 합집합이 주 키가 됨
- 관계 집합에서 화살표가 업는 부분의 개체 집합의 주 키가 스키마의 주 키로 제공

### 확장된 E-R의 특성

#### 세분화 (specialization)

- 다른 개체들과 어떤 방법이로든 구분되어지는 개체들의 하위 그룹을 가질 수 있음
  - 확실히 구분되어지는 개체의 그룹을 표현하는 수단을 제공
- 어떤 개체 집합 내에서 하위 그룹을 표시하는 과정을 세분화라고 함

1. 중복되는 세분화 (overlapping specialization) : 어떤 개체가 복수의 세분화된 개체 집합에 속할 수 있는 경우
2. 중복되지 않는 세분화(disjoint specialization) : 최대 하나의 세분화된 개체 집합에 속해야한 하는지

#### 일반화(generalization) 

- 공통된 특성에 기초하여 상위 개체 집합으로 합쳐지는 것
  - 상위 개체 집합과 하위 개체 집합의 사이에 존재하는 포함 관계
  - 상위 클래스(super class) 와 하위 클래스 (sub class) 로 부름
- 일반화의 제약조건 : 특정한 일반화에 어떤 제약조건을 둘 수 있음
  - 조건에 의한 정의 : 개체가 어떤 명확한 조건을 만족하는지 아닌지에 의해 평가
  - 사용자에 의한 정의 : 결정을 내릴 책임을 가진 이용자가 개인적인 기준에 의해 결정
    - 데이터베이스 사용자가 주어진 개체 집합에 개체를 할당
  - 하위 개체 집합
    1. 분리(disjoint) : 하나의 개체는 단지 하나의 하위 개체 집합에만 속해야 함
    2. 중첩(overlapping) : 하나 이상의 하위 개체 집합에 속할 수 있음
  - 완전성 제약조건 : 상위 개체 집합에 있는 개체가 일반화나 세분화에서 반드시 하나 이상의 하위 개체 집합에 속해야 하는지 아닌지
    1. 전체 일반화 : 각각의 상위 개체는 하위 개체 집합에 속함
    2. 부분 일반화 : 어떤 상위 개체는 하위 개체 집합세 속하지 않을 수돌 있음
       - 부분 일반화가 기본사항
- 일반화의 표현
  - E-R 다이어그램을 테이블 형태로 바꾸는 2가지 방법
    1. 상위 개체를 위한 스키마를 만든다.
       - 각각의 하위 개체 집합을 위해 각 개체 집합의 속성들과 상위 개체 집합의 주 키인 속성들에 대한 속성을 가지는 스키마를 만든다.
    2. 일반화가 분리이면서 완전 일반화인 경우, 상위 개체 집합의 모든 개체는 하위 개체 집합들 중 하나의 구성원이면 또 다른 표현도 가능
       - 상위 개체 집합을 위한 스키마를 만들지 않음

#### 속성의 상속(attribute inheritance)

- 상위 개체 집합의 속성들은 하위 개체 집합들에 의해 상속된
  - 하위 개체 집합의 모든 단계에 걸쳐 적용된
- 단일 상속(single ingeritance) 또는 다중 상속(multiple inheritance)

### 데이터를 모델리하기 위한 대안적인 표기법

#### Unified Modeling Language(UML)

- 개체-관계 다이어그램은 소프트웨어 시스템의 데이터 표현 구성요소를 모델링하는데 도움됨

1. class diagram
2. use case diagram : 시스템과 사용자간의 상호 작용
3. activity diagram : 시스템의 다양한 컴포넌트들 간의 작접의 흐름
4. implementation disgram

### 데이터베이스 설계의 다른 관점들

#### 데이터 제약조건과 관계형 데이터베이스 설계

- 제약조건

  - 일관성 보전의 자동화 : 설계자는 데이터베이스 시스템 자체가 제약조건을 유지하는 것을 확신할 수 있음

  - 데이터베이스 스키마를 설계하는데 있어서 유용
  - 데이터의 물리적 구조를 결정하는데에도 유용
    - 어떤 인덱스 구조는 주 키의 인덱스보다 더 좋은 성능을 냄

#### 사용 요구사항 : 질의, 성능

- 성능 측정을 위한 2가지 기준
  1. 처리량(throughput) : 단위 시간별 평균적으로 수행되어지는 질의나 갱신
  2. 응답시간(response time) : 평균 혹은 최악의 경우에 한 개의 트랜젝션이 시작부터 마칠때까지의 시간의 양
- 많은 수의 트랜젝션을 처리하는 시스템은 처리량에 초점
- 시간이 중요한 요소인 시스템은 응답시간에 초점
  - 대부분의 상업 데이터베이스 시스템은 역사적으로 처리랴에 초첨
- 조인 연산에 관계되는 질의는 평가될 때 더 많은 자원을 요구
  - 조인 연산의 평가를 용이하게 해주는 인덱스 생성
  - 선택 연산의 술어(where)의 평가 속도를 빠르게 하기 위해 인덱스 생성
- 인덱스가 질의의 속도를 높이지만 갱신을 느리게 하며 인덱스의 정확성을 유지하기 위해 추가적인 작업이 필요